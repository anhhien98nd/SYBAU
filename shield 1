-- âš™ï¸ Auto Shield (Optimized + Lightweight)
-- Báº­t/Táº¯t khi Ä‘áº¿n thá»i Ä‘iá»ƒm chá»‰ Ä‘á»‹nh, theo nguyÃªn táº¯c khÃ´ng lÃ m náº·ng

local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- âš™ï¸ Schedule
local SCHEDULE = {
    {71, 79},
    {94, 102},
    {115, 124},
}

-- âš™ï¸ TÃ¬m remote an toÃ n
local remote
pcall(function()
    local bridge = ReplicatedStorage:FindFirstChild("BridgeNet2")
    if bridge then
        remote = bridge:FindFirstChild("dataRemoteEvent")
    end
    if not remote then
        for _, v in ipairs(ReplicatedStorage:GetDescendants()) do
            if v.Name == "dataRemoteEvent" then
                remote = v
                break
            end
        end
    end
end)

-- âš™ï¸ Gá»­i tÃ­n hiá»‡u an toÃ n
local function safeFireShield(state)
    if not remote then
        if not safeFireShield._warned then
            warn("[Auto Shield] âš ï¸ KhÃ´ng tÃ¬m tháº¥y dataRemoteEvent.")
            safeFireShield._warned = true
        end
        return
    end

    pcall(function()
        remote:FireServer({ state, "\024" })
    end)
end

-- âš™ï¸ Tráº¡ng thÃ¡i script
local AutoShield = {
    active = false,
    thread = nil,
    tick0 = tick(),
}

-- ğŸ§¹ HÃ m cleanup
function AutoShield:Stop()
    if not self.active then return end
    self.active = false

    if self.thread and coroutine.close then
        pcall(function() coroutine.close(self.thread) end)
    end
    self.thread = nil

    pcall(function() collectgarbage("collect") end)
    print("[Auto Shield] ğŸ”´ ÄÃ£ dá»«ng & dá»n dáº¹p hoÃ n táº¥t.")
end

-- âš™ï¸ Thread chÃ­nh
local function StartAutoShield()
    if AutoShield.active then
        warn("[Auto Shield] Äang hoáº¡t Ä‘á»™ng â€” bá» qua khá»Ÿi Ä‘á»™ng trÃ¹ng.")
        return
    end
    AutoShield.active = true
    AutoShield.tick0 = tick()

    print(("[Auto Shield] ğŸŸ¢ Báº¯t Ä‘áº§u (tá»•ng %d lá»‹ch)."):format(#SCHEDULE))

    AutoShield.thread = coroutine.create(function()
        for i, window in ipairs(SCHEDULE) do
            if not AutoShield.active then break end
            local startSec, endSec = window[1], window[2]

            if type(startSec) ~= "number" or type(endSec) ~= "number" or endSec <= startSec then
                warn(("[Auto Shield] âš ï¸ Schedule #%d khÃ´ng há»£p lá»‡."):format(i))
                continue
            end

            local startTime = AutoShield.tick0 + startSec
            local endTime = AutoShield.tick0 + endSec

            -- ğŸ•’ Äá»£i tá»›i thá»i Ä‘iá»ƒm báº­t
            local waitTime = startTime - tick()
            if waitTime > 0 then
                task.wait(waitTime)
            end

            if tick() >= endTime then
                warn(("[Auto Shield] â© Schedule #%d trá»… â€” bá» qua."):format(i))
                continue
            end

            print(("[Auto Shield] ğŸŸ© Báº¬T #%d (%.1fs â†’ %.1fs)"):format(i, startSec, endSec))
            safeFireShield(true)

            -- â³ Chá» Ä‘áº¿n khi cáº§n táº¯t
            while AutoShield.active and tick() < endTime do
                task.wait(0.05)
            end

            safeFireShield(false)
            print(("[Auto Shield] ğŸŸ¥ Táº®T #%d (%.1fs)").format(i, endSec))
        end

        AutoShield:Stop()
    end)

    task.spawn(function()
        coroutine.resume(AutoShield.thread)
    end)
end

-- ğŸŸ¢ Khá»Ÿi Ä‘á»™ng
StartAutoShield()

-- ğŸ›‘ Dá»«ng thá»§ cÃ´ng
getgenv().StopAutoShield = function()
    AutoShield:Stop()
end
