-- ‚öôÔ∏è Auto TP2 Lock (Optimized + Safe Version)
-- B·∫≠t t·∫°i gi√¢y 10, t·∫Øt t·∫°i gi√¢y 134 (t·ªïng)
-- √Åp d·ª•ng nguy√™n t·∫Øc nh·∫π CPU, c√≥ cleanup, v√† an to√†n

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local p = Players.LocalPlayer

-- ‚öôÔ∏è C·∫•u h√¨nh
local START_DELAY = 10       -- Th·ªùi gian ƒë·ª£i tr∆∞·ªõc khi b·∫≠t (gi√¢y)
local STOP_AFTER = 134       -- T·ªïng th·ªùi gian ho·∫°t ƒë·ªông (gi√¢y)
local LOCK_POS = Vector3.new(42.29, 3.63, -132.49)
local UPDATE_INTERVAL = 0.05 -- T·∫ßn su·∫•t c·∫≠p nh·∫≠t (gi√¢y)

-- ‚öôÔ∏è Tr·∫°ng th√°i v√† qu·∫£n l√Ω t√†i nguy√™n
local TP2Lock = {
	active = false,
	thread = nil,
	startTime = tick(),
}

-- üßπ H√†m cleanup an to√†n
function TP2Lock:Stop()
	if not self.active then return end
	self.active = false

	if self.thread and coroutine.close then
		pcall(function() coroutine.close(self.thread) end)
	end
	self.thread = nil

	pcall(function() collectgarbage("collect") end)
	print("[TP2 Lock] üî¥ D·ª´ng v√† d·ªçn d·∫πp xong.")
end

-- ‚öôÔ∏è H√†m b·∫≠t TP2 Lock
local function StartTP2Lock()
	if TP2Lock.active then
		warn("[TP2 Lock] ƒê√£ b·∫≠t r·ªìi.")
		return
	end

	TP2Lock.active = true
	TP2Lock.startTime = tick()
	print(string.format("[TP2 Lock] üü¢ B·∫≠t TP2 Lock t·∫°i gi√¢y %.1f", START_DELAY))

	local function getHRP()
		local char = p.Character
		return char and char:FindFirstChild("HumanoidRootPart")
	end

	-- L∆∞u h∆∞·ªõng nh√¨n ban ƒë·∫ßu (tr√°nh c·∫≠p nh·∫≠t li√™n t·ª•c)
	local lookVector
	pcall(function()
		local hrp = getHRP()
		if hrp then
			lookVector = hrp.CFrame.LookVector
		end
	end)

	-- Thread gi·ªØ lock nh·∫π nh√†ng
	TP2Lock.thread = coroutine.create(function()
		while TP2Lock.active do
			local hrp = getHRP()
			if hrp then
				pcall(function()
					hrp.Velocity = Vector3.zero
					local targetCF = lookVector
						and CFrame.new(LOCK_POS, LOCK_POS + lookVector)
						or CFrame.new(LOCK_POS)
					hrp.CFrame = targetCF
				end)
			end
			task.wait(UPDATE_INTERVAL)
		end
	end)

	task.spawn(function()
		coroutine.resume(TP2Lock.thread)
	end)

	-- T·ª± d·ª´ng sau STOP_AFTER gi√¢y t·ªïng
	task.delay(STOP_AFTER, function()
		if TP2Lock.active then
			print(string.format("[TP2 Lock] üî¥ T·∫Øt TP2 Lock t·∫°i gi√¢y %.1f (t·ªïng)", STOP_AFTER))
			TP2Lock:Stop()
		end
	end)
end

-- üîÑ Ch·∫°y script sau START_DELAY
task.delay(START_DELAY, StartTP2Lock)

-- üõë Cho ph√©p d·ª´ng th·ªß c√¥ng
getgenv().StopTP2Lock = function()
	TP2Lock:Stop()
end
