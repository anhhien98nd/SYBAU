-- ‚öôÔ∏è Auto TP1 Lock (Optimized + Safe Version)
-- B·∫≠t t·∫°i gi√¢y 10, t·∫Øt t·∫°i gi√¢y 134 t·ªïng
-- √Åp d·ª•ng nguy√™n t·∫Øc: nh·∫π CPU, c√≥ cleanup, kh√¥ng leak

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local p = Players.LocalPlayer

-- C·∫•u h√¨nh
local START_DELAY = 10      -- gi√¢y b·∫≠t
local STOP_AFTER = 134      -- t·ªïng th·ªùi gian
local LOCK_POS = Vector3.new(40, 3.63, -130.14)
local UPDATE_INTERVAL = 0.05 -- delay gi·ªØa m·ªói l·∫ßn lock (gi·∫£m CPU)

-- Tr·∫°ng th√°i qu·∫£n l√Ω
local TP1Lock = {
	active = false,
	conn = nil,
	thread = nil,
	startTime = tick(),
}

-- H√†m cleanup (d·ª´ng m·ªçi th·ª©)
function TP1Lock:Stop()
	if not self.active then return end
	self.active = false

	if self.conn then
		pcall(function() self.conn:Disconnect() end)
		self.conn = nil
	end

	if self.thread and coroutine.close then
		pcall(function() coroutine.close(self.thread) end)
		self.thread = nil
	end

	collectgarbage("collect")
	print("[TP1 Lock] üî¥ D·ª´ng v√† d·ªçn d·∫πp xong.")
end

-- H√†m ch√≠nh (ch·∫°y lock)
local function StartTP1Lock()
	if TP1Lock.active then
		warn("[TP1 Lock] ƒê√£ b·∫≠t r·ªìi.")
		return
	end

	TP1Lock.active = true
	TP1Lock.startTime = tick()

	print(string.format("[TP1 Lock] üü¢ B·∫≠t TP1 Lock t·∫°i gi√¢y %.1f", START_DELAY))

	local function getHRP()
		local char = p.Character
		return char and char:FindFirstChild("HumanoidRootPart")
	end

	-- X√°c ƒë·ªãnh h∆∞·ªõng nh√¨n ban ƒë·∫ßu
	local lookVector
	pcall(function()
		local hrp = getHRP()
		if hrp then
			lookVector = hrp.CFrame.LookVector
		end
	end)

	-- Thread gi·ªØ lock
	TP1Lock.thread = coroutine.create(function()
		while TP1Lock.active do
			local hrp = getHRP()
			if hrp then
				pcall(function()
					hrp.Velocity = Vector3.zero
					local targetCFrame = lookVector
						and CFrame.new(LOCK_POS, LOCK_POS + lookVector)
						or CFrame.new(LOCK_POS)
					hrp.CFrame = targetCFrame
				end)
			end
			task.wait(UPDATE_INTERVAL)
		end
	end)
	coroutine.resume(TP1Lock.thread)

	-- T·ª± t·∫Øt sau STOP_AFTER gi√¢y t·ªïng
	task.delay(STOP_AFTER, function()
		if TP1Lock.active then
			print(string.format("[TP1 Lock] üî¥ T·∫Øt TP1 Lock t·∫°i gi√¢y %.1f t·ªïng", STOP_AFTER))
			TP1Lock:Stop()
		end
	end)
end

-- B·∫Øt ƒë·∫ßu sau START_DELAY
task.delay(START_DELAY, StartTP1Lock)

-- Cho ph√©p d·ª´ng th·ªß c√¥ng
getgenv().StopTP1Lock = function()
	TP1Lock:Stop()
end
