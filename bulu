-- ⚙️ UNIFIED CONTROL PANEL (TP / Spam M1 / Spam 2 / AutoMove / ToggleFire)
-- GUI cố định, ResetOnSpawn = false — AutoMove đã sửa hoạt động ổn định

--// Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local player = Players.LocalPlayer
local PlayerGui = player:WaitForChild("PlayerGui")

--// Remote
local remote = ReplicatedStorage:WaitForChild("BridgeNet2"):WaitForChild("dataRemoteEvent")

--// CONFIG: destinations (TP)
local destinations = {
	["kophaiomaidemve"] = Vector3.new(18.37334884643555, 0.37274569272994995, -140.72775268554688),
	["ddumevailn"] = Vector3.new(18.86713409423828, 0.37274569272994995, -114.86202239990234)
}
local buttonNames = {
	["kophaiomaidemve"] = "Cổng 2",
	["ddumevailn"] = "Cổng 1"
}

--// Spam args
local spamM1_args = {
	{
		{
			buffer.fromstring("\019\000\000\0000201000113686372022\000"),
			game:GetService("Players"):WaitForChild("@@").Character
		},
		"\019"
	}
}
local spam2_args = {
	{
		{
			buffer.fromstring("\019\000\000\0000201100101186595482\000")
		},
		"\019"
	}
}
-- ToggleFire args template
local function toggleFireArgs(value)
	return {
		{
			value,
			"\024"
		}
	}
end

--// State variables
local spamM1 = false
local spamM1Delay = 0.35
local spam2 = false
local spam2Delay = 0.65
local toggleFireEnabled = false

--// HELPERS
local function safeFire(argsTable)
	pcall(function()
		remote:FireServer(unpack(argsTable))
	end)
end

local function teleportTo(name)
	local dest = destinations[name]
	local char = player.Character or player.CharacterAdded:Wait()
	local hrp = char:FindFirstChild("HumanoidRootPart")
	local hum = char:FindFirstChildOfClass("Humanoid")
	if hrp and dest then
		hrp.CFrame = CFrame.new(dest + Vector3.new(0, 5, 0))
		if hum then hum:ChangeState(Enum.HumanoidStateType.Jumping) end
	end
end

--// GUI chính
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "UnifiedControlGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = PlayerGui

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 360, 0, 380)
mainFrame.Position = UDim2.new(0, 20, 0, 150)
mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui
mainFrame.Active = true
mainFrame.Draggable = false

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -20, 0, 30)
title.Position = UDim2.new(0, 10, 0, 8)
title.BackgroundTransparency = 1
title.Text = "⚙️ Unified Control Panel"
title.Font = Enum.Font.GothamBold
title.TextSize = 18
title.TextColor3 = Color3.fromRGB(255,255,255)
title.Parent = mainFrame

local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0, 28, 0, 28)
closeBtn.Position = UDim2.new(1, -38, 0, 6)
closeBtn.Text = "X"
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextSize = 16
closeBtn.TextColor3 = Color3.fromRGB(255,255,255)
closeBtn.BackgroundColor3 = Color3.fromRGB(200,0,0)
closeBtn.BorderSizePixel = 0
closeBtn.Parent = mainFrame
closeBtn.MouseButton1Click:Connect(function()
	spamM1 = false
	spam2 = false
	toggleFireEnabled = false
	screenGui:Destroy()
end)

local y = 50
local function makeSectionLabel(text)
	local lbl = Instance.new("TextLabel")
	lbl.Size = UDim2.new(1, -20, 0, 22)
	lbl.Position = UDim2.new(0, 10, 0, y)
	lbl.BackgroundTransparency = 1
	lbl.Text = text
	lbl.Font = Enum.Font.SourceSansSemibold
	lbl.TextSize = 14
	lbl.TextColor3 = Color3.fromRGB(200,200,200)
	lbl.TextXAlignment = Enum.TextXAlignment.Left
	lbl.Parent = mainFrame
	y = y + 24
end

local function makeButton(text, px, py, w, h)
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(0, w, 0, h)
	btn.Position = UDim2.new(0, px, 0, py)
	btn.Text = text
	btn.Font = Enum.Font.Gotham
	btn.TextSize = 14
	btn.TextColor3 = Color3.fromRGB(255,255,255)
	btn.BackgroundColor3 = Color3.fromRGB(50,50,50)
	btn.BorderSizePixel = 0
	btn.Parent = mainFrame
	return btn
end

-- ===== TP Section =====
makeSectionLabel("🔁 Teleport")
local tpY = y
for accountName, _ in pairs(destinations) do
	local nameDisplay = buttonNames[accountName] or accountName
	local btn = makeButton("TP: "..nameDisplay, 10, tpY, 160, 30)
	btn.MouseButton1Click:Connect(function() teleportTo(accountName) end)
	tpY = tpY + 36
end
y = tpY + 4

-- ===== Spam M1 =====
makeSectionLabel("⚡ Spam M1 (0.35s)")
local spamM1Btn = makeButton("Bật Spam M1", 10, y, 160, 30)
local spamM1Status = Instance.new("TextLabel")
spamM1Status.Size = UDim2.new(0, 160, 0, 18)
spamM1Status.Position = UDim2.new(0, 180, 0, y + 6)
spamM1Status.BackgroundTransparency = 1
spamM1Status.Text = "Tắt"
spamM1Status.Font = Enum.Font.SourceSans
spamM1Status.TextSize = 14
spamM1Status.TextColor3 = Color3.fromRGB(255,255,255)
spamM1Status.Parent = mainFrame
y = y + 40

spamM1Btn.MouseButton1Click:Connect(function()
	spamM1 = not spamM1
	if spamM1 then
		spamM1Btn.Text = "Tắt Spam M1"
		spamM1Btn.BackgroundColor3 = Color3.fromRGB(200,50,50)
		spamM1Status.Text = "Đang chạy"
	else
		spamM1Btn.Text = "Bật Spam M1"
		spamM1Btn.BackgroundColor3 = Color3.fromRGB(50,50,50)
		spamM1Status.Text = "Tắt"
	end
end)

-- ===== Spam 2 =====
makeSectionLabel("🔥 Spam 2 (0.65s)")
local spam2Btn = makeButton("Bật Spam 2", 10, y, 160, 30)
local spam2Status = Instance.new("TextLabel")
spam2Status.Size = UDim2.new(0, 160, 0, 18)
spam2Status.Position = UDim2.new(0, 180, 0, y + 6)
spam2Status.BackgroundTransparency = 1
spam2Status.Text = "Tắt"
spam2Status.Font = Enum.Font.SourceSans
spam2Status.TextSize = 14
spam2Status.TextColor3 = Color3.fromRGB(255,255,255)
spam2Status.Parent = mainFrame
y = y + 40

spam2Btn.MouseButton1Click:Connect(function()
	spam2 = not spam2
	if spam2 then
		spam2Btn.Text = "Tắt Spam 2"
		spam2Btn.BackgroundColor3 = Color3.fromRGB(200,50,50)
		spam2Status.Text = "Đang chạy"
	else
		spam2Btn.Text = "Bật Spam 2"
		spam2Btn.BackgroundColor3 = Color3.fromRGB(50,50,50)
		spam2Status.Text = "Tắt"
	end
end)

-- ===== Toggle Fire =====
makeSectionLabel("🔘 Toggle Fire")
local toggleFireBtn = makeButton("Bật ToggleFire", 10, y, 160, 30)
local toggleFireStatus = Instance.new("TextLabel")
toggleFireStatus.Size = UDim2.new(0, 160, 0, 18)
toggleFireStatus.Position = UDim2.new(0, 180, 0, y + 6)
toggleFireStatus.BackgroundTransparency = 1
toggleFireStatus.Text = "Tắt"
toggleFireStatus.Font = Enum.Font.SourceSans
toggleFireStatus.TextSize = 14
toggleFireStatus.TextColor3 = Color3.fromRGB(255,255,255)
toggleFireStatus.Parent = mainFrame
y = y + 40

toggleFireBtn.MouseButton1Click:Connect(function()
	toggleFireEnabled = not toggleFireEnabled
	if toggleFireEnabled then
		toggleFireBtn.Text = "Tắt ToggleFire"
		toggleFireBtn.BackgroundColor3 = Color3.fromRGB(200,50,50)
		toggleFireStatus.Text = "Đang ON"
		safeFire(toggleFireArgs(true))
	else
		toggleFireBtn.Text = "Bật ToggleFire"
		toggleFireBtn.BackgroundColor3 = Color3.fromRGB(50,50,50)
		toggleFireStatus.Text = "Tắt"
		safeFire(toggleFireArgs(false))
	end
end)

-- ===== Auto Move (đã fix hoạt động) =====
makeSectionLabel("🏃 Auto Move (nhanh)")
local autoMoveBtn = makeButton("Bật Auto Move", 10, y, 160, 30)
local autoMoveStatus = Instance.new("TextLabel")
autoMoveStatus.Size = UDim2.new(0, 160, 0, 18)
autoMoveStatus.Position = UDim2.new(0, 180, 0, y + 6)
autoMoveStatus.BackgroundTransparency = 1
autoMoveStatus.Text = "Tắt"
autoMoveStatus.Font = Enum.Font.SourceSans
autoMoveStatus.TextSize = 14
autoMoveStatus.TextColor3 = Color3.fromRGB(255,255,255)
autoMoveStatus.Parent = mainFrame
y = y + 40

local moving = false

autoMoveBtn.MouseButton1Click:Connect(function()
	moving = not moving
	if moving then
		autoMoveBtn.Text = "Tắt Auto Move"
		autoMoveBtn.BackgroundColor3 = Color3.fromRGB(0,200,100)
		autoMoveStatus.Text = "Đang ON"
	else
		autoMoveBtn.Text = "Bật Auto Move"
		autoMoveBtn.BackgroundColor3 = Color3.fromRGB(50,50,50)
		autoMoveStatus.Text = "Tắt"
	end
end)

task.spawn(function()
	while true do
		if moving then
			local char = player.Character or player.CharacterAdded:Wait()
			local humanoid = char:FindFirstChildOfClass("Humanoid")
			if humanoid and humanoid.Health > 0 then
				humanoid:Move(Vector3.new(0, 0, -1), true)
			end
		end
		task.wait(0.05)
	end
end)

-- Footer
local footer = Instance.new("TextLabel")
footer.Size = UDim2.new(1, -20, 0, 22)
footer.Position = UDim2.new(0, 10, 1, -30)
footer.BackgroundTransparency = 1
footer.Text = "GUI cố định. Spam chạy song song."
footer.Font = Enum.Font.SourceSans
footer.TextSize = 12
footer.TextColor3 = Color3.fromRGB(180,180,180)
footer.TextXAlignment = Enum.TextXAlignment.Left
footer.Parent = mainFrame

--// Loops
task.spawn(function()
	while true do
		if spamM1 then safeFire(spamM1_args) end
		task.wait(spamM1Delay)
	end
end)

task.spawn(function()
	while true do
		if spam2 then safeFire(spam2_args) end
		task.wait(spam2Delay)
	end
end)

print("✅ UnifiedControlGui loaded — AutoMove fixed & GUI persistent.")
